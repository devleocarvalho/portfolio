<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Checklist de Cuidados - UTI</title>
    <link rel="stylesheet" href="./style.css" />
</head>
<body>
    <div class="container">
        <h2>Checklist de Cuidados - UTI</h2>
        <div class="tab-buttons">
            <button class="tab-button" onclick="openTab(event, 'tab1', 'Leito 1')">Leito 1</button>
            <button class="tab-button" onclick="openTab(event, 'tab2', 'Leito 2')">Leito 2</button>
            <button class="tab-button" onclick="openTab(event, 'tab3', 'Leito 3')">Leito 3</button>
            <button class="tab-button" onclick="openTab(event, 'tab4', 'Leito 4')">Leito 4</button>
            <button class="tab-button" onclick="openTab(event, 'tab5', 'Leito 5')">Leito 5</button>
            <button class="tab-button" onclick="openTab(event, 'tab6', 'Leito 6')">Leito 6</button>
            <button class="tab-button" onclick="openTab(event, 'tab7', 'Leito 7')">Leito 7</button>
            <button class="tab-button" onclick="openTab(event, 'tab8', 'Leito 8')">Leito 8</button>
            <button class="tab-button" onclick="openTab(event, 'tab9', 'Leito 9')">Leito 9</button>
            <button class="tab-button" onclick="openTab(event, 'tab10', 'Leito 10')">Leito 10</button>
        </div>
        <div id="tab1" class="tab active">
            <input type="date" id="data1" onchange="validateDate(1)">
            <input type="time" id="horario1">
            <input type="text" id="paciente1" placeholder="Nome do Paciente">
            <input type="text" id="leito1" placeholder="Leito" readonly>
            <div id="checklist1"></div>
            <textarea id="observacoes1" placeholder="Observações"></textarea>
            <button onclick="calculateScore(1)">Calcular Acerto</button>
            <button onclick="exportToDoc(1)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(1)">Emitir Relatório Mensal PAV</button>
            <div id="resultado1" class="resultado"></div>
            <div id="classificacao1" class="classificacao"></div>
            <div class="calendar" id="calendar1"></div>
            <div class="continuity-bar" id="continuity1"></div>
        </div>
        <div id="tab2" class="tab">
            <input type="date" id="data2" onchange="validateDate(2)">
            <input type="time" id="horario2">
            <input type="text" id="paciente2" placeholder="Nome do Paciente">
            <input type="text" id="leito2" placeholder="Leito" readonly>
            <div id="checklist2"></div>
            <textarea id="observacoes2" placeholder="Observações"></textarea>
            <button onclick="calculateScore(2)">Calcular Acerto</button>
            <button onclick="exportToDoc(2)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(2)">Emitir Relatório Mensal PAV</button>
            <div id="resultado2" class="resultado"></div>
            <div id="classificacao2" class="classificacao"></div>
            <div class="calendar" id="calendar2"></div>
            <div class="continuity-bar" id="continuity2"></div>
        </div>
        <div id="tab3" class="tab">
            <input type="date" id="data3" onchange="validateDate(3)">
            <input type="time" id="horario3">
            <input type="text" id="paciente3" placeholder="Nome do Paciente">
            <input type="text" id="leito3" placeholder="Leito" readonly>
            <div id="checklist3"></div>
            <textarea id="observacoes3" placeholder="Observações"></textarea>
            <button onclick="calculateScore(3)">Calcular Acerto</button>
            <button onclick="exportToDoc(3)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(3)">Emitir Relatório Mensal PAV</button>
            <div id="resultado3" class="resultado"></div>
            <div id="classificacao3" class="classificacao"></div>
            <div class="calendar" id="calendar3"></div>
            <div class="continuity-bar" id="continuity3"></div>
        </div>
        <div id="tab4" class="tab">
            <input type="date" id="data4" onchange="validateDate(4)">
            <input type="time" id="horario4">
            <input type="text" id="paciente4" placeholder="Nome do Paciente">
            <input type="text" id="leito4" placeholder="Leito" readonly>
            <div id="checklist4"></div>
            <textarea id="observacoes4" placeholder="Observações"></textarea>
            <button onclick="calculateScore(4)">Calcular Acerto</button>
            <button onclick="exportToDoc(4)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(4)">Emitir Relatório Mensal PAV</button>
            <div id="resultado4" class="resultado"></div>
            <div id="classificacao4" class="classificacao"></div>
            <div class="calendar" id="calendar4"></div>
            <div class="continuity-bar" id="continuity4"></div>
        </div>
        <div id="tab5" class="tab">
            <input type="date" id="data5" onchange="validateDate(5)">
            <input type="time" id="horario5">
            <input type="text" id="paciente5" placeholder="Nome do Paciente">
            <input type="text" id="leito5" placeholder="Leito" readonly>
            <div id="checklist5"></div>
            <textarea id="observacoes5" placeholder="Observações"></textarea>
            <button onclick="calculateScore(5)">Calcular Acerto</button>
            <button onclick="exportToDoc(5)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(5)">Emitir Relatório Mensal PAV</button>
            <div id="resultado5" class="resultado"></div>
            <div id="classificacao5" class="classificacao"></div>
            <div class="calendar" id="calendar5"></div>
            <div class="continuity-bar" id="continuity5"></div>
        </div>
        <div id="tab6" class="tab">
            <input type="date" id="data6" onchange="validateDate(6)">
            <input type="time" id="horario6">
            <input type="text" id="paciente6" placeholder="Nome do Paciente">
            <input type="text" id="leito6" placeholder="Leito" readonly>
            <div id="checklist6"></div>
            <textarea id="observacoes6" placeholder="Observações"></textarea>
            <button onclick="calculateScore(6)">Calcular Acerto</button>
            <button onclick="exportToDoc(6)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(6)">Emitir Relatório Mensal PAV</button>
            <div id="resultado6" class="resultado"></div>
            <div id="classificacao6" class="classificacao"></div>
            <div class="calendar" id="calendar6"></div>
            <div class="continuity-bar" id="continuity6"></div>
        </div>
        <div id="tab7" class="tab">
            <input type="date" id="data7" onchange="validateDate(7)">
            <input type="time" id="horario7">
            <input type="text" id="paciente7" placeholder="Nome do Paciente">
            <input type="text" id="leito7" placeholder="Leito" readonly>
            <div id="checklist7"></div>
            <textarea id="observacoes7" placeholder="Observações"></textarea>
            <button onclick="calculateScore(7)">Calcular Acerto</button>
            <button onclick="exportToDoc(7)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(7)">Emitir Relatório Mensal PAV</button>
            <div id="resultado7" class="resultado"></div>
            <div id="classificacao7" class="classificacao"></div>
            <div class="calendar" id="calendar7"></div>
            <div class="continuity-bar" id="continuity7"></div>
        </div>
        <div id="tab8" class="tab">
            <input type="date" id="data8" onchange="validateDate(8)">
            <input type="time" id="horario8">
            <input type="text" id="paciente8" placeholder="Nome do Paciente">
            <input type="text" id="leito8" placeholder="Leito" readonly>
            <div id="checklist8"></div>
            <textarea id="observacoes8" placeholder="Observações"></textarea>
            <button onclick="calculateScore(8)">Calcular Acerto</button>
            <button onclick="exportToDoc(8)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(8)">Emitir Relatório Mensal PAV</button>
            <div id="resultado8" class="resultado"></div>
            <div id="classificacao8" class="classificacao"></div>
            <div class="calendar" id="calendar8"></div>
            <div class="continuity-bar" id="continuity8"></div>
        </div>
        <div id="tab9" class="tab">
            <input type="date" id="data9" onchange="validateDate(9)">
            <input type="time" id="horario9">
            <input type="text" id="paciente9" placeholder="Nome do Paciente">
            <input type="text" id="leito9" placeholder="Leito" readonly>
            <div id="checklist9"></div>
            <textarea id="observacoes9" placeholder="Observações"></textarea>
            <button onclick="calculateScore(9)">Calcular Acerto</button>
            <button onclick="exportToDoc(9)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(9)">Emitir Relatório Mensal PAV</button>
            <div id="resultado9" class="resultado"></div>
            <div id="classificacao9" class="classificacao"></div>
            <div class="calendar" id="calendar9"></div>
            <div class="continuity-bar" id="continuity9"></div>
        </div>
        <div id="tab10" class="tab">
            <input type="date" id="data10" onchange="validateDate(10)">
            <input type="time" id="horario10">
            <input type="text" id="paciente10" placeholder="Nome do Paciente">
            <input type="text" id="leito10" placeholder="Leito" readonly>
            <div id="checklist10"></div>
            <textarea id="observacoes10" placeholder="Observações"></textarea>
            <button onclick="calculateScore(10)">Calcular Acerto</button>
            <button onclick="exportToDoc(10)">Emitir Relatório Diário</button>
            <button onclick="exportMonthlyReport(10)">Emitir Relatório Mensal PAV</button>
            <div id="resultado10" class="resultado"></div>
            <div id="classificacao10" class="classificacao"></div>
            <div class="calendar" id="calendar10"></div>
            <div class="continuity-bar" id="continuity10"></div>
        </div>
    </div>
    <script>
        const checklistItems = [
            "Higienização das mãos dentro dos cinco momentos preconizados.",
            "Manter paciente em decúbito elevado (30-45 graus).",
            "Adequar diariamente o nível de sedação(desmame).",
            "Teste de respiração espontânea.",
            "Aspirar a secreção subglótica rotineiramente, a naso e orofaringe.",
            "Monitorizar a pressão do cuff do tubo(22-30).",
            "Realizar a higiene oral do paciente com antissépticos diariamente.",
            "Teve febre de origem pulmonar nas últimas 24 horas?"
        ];
        const correctAnswers = {
            "Higienização das mãos dentro dos cinco momentos preconizados.": "Sim",
            "Manter paciente em decúbito elevado (30-45 graus).": "Sim",
            "Adequar diariamente o nível de sedação(desmame).": "Sim",
            "Teste de respiração espontânea.": "Sim",
            "Aspirar a secreção subglótica rotineiramente, a naso e orofaringe.": "Sim",
            "Monitorizar a pressão do cuff do tubo(22-30).": "Sim",
            "Realizar a higiene oral do paciente com antissépticos diariamente.": "Sim",
            "Teve febre de origem pulmonar nas últimas 24 horas?": "Não"
        };

        // Armazenamento de dados por leito
        const storage = {};
        for (let i = 1; i <= 10; i++) {
            storage[`leito${i}`] = [];
        }

        // Função para validar a data (não permitir datas anteriores ao dia atual)
        function validateDate(tabNumber) {
            const inputDate = document.getElementById(`data${tabNumber}`);
            const selectedDate = new Date(inputDate.value);
            const today = new Date();
            today.setHours(0, 0, 0, 0); // Ignorar horas para comparar apenas a data

            if (selectedDate < today) {
                alert("Não é permitido preencher dados para datas anteriores ao dia atual.");
                inputDate.value = today.toISOString().split('T')[0]; // Define a data atual
            }
        }

        // Função para abrir a aba e preencher o campo "Leito"
        function openTab(evt, tabName, leito) {
            const tabButtons = document.querySelectorAll(".tab-button");
            tabButtons.forEach(button => button.classList.remove("active"));
            evt.currentTarget.classList.add("active");

            const tabs = document.querySelectorAll(".tab");
            tabs.forEach(tab => tab.classList.remove("active"));
            document.getElementById(tabName).classList.add("active");

            // Preenche o campo "Leito" automaticamente
            const leitoInput = document.getElementById(`leito${tabName.slice(-1)}`);
            leitoInput.value = leito;
        }

        // Inicializa as checklists e calendários para cada aba
        function initializeChecklist(tabNumber) {
            const checklistContainer = document.getElementById(`checklist${tabNumber}`);
            checklistContainer.innerHTML = '';
            checklistItems.forEach(item => {
                const div = document.createElement("div");
                div.classList.add("checklist-item");
                div.innerHTML = `<span>${item}</span>
                    <div class="btn-group">
                        <button class="btn" onclick="toggleSelection(this, '${item}', 'Sim', ${tabNumber})">Sim</button>
                        <button class="btn" onclick="toggleSelection(this, '${item}', 'Não', ${tabNumber})">Não</button>
                    </div>`;
                checklistContainer.appendChild(div);
            });
        }

        const selections = {};
        function toggleSelection(button, item, value, tabNumber) {
            if (!selections[tabNumber]) selections[tabNumber] = {};
            selections[tabNumber][item] = value;
            const buttons = button.parentElement.querySelectorAll(".btn");
            buttons.forEach(btn => btn.classList.remove("selected"));
            button.classList.add("selected");
        }

        function calculateScore(tabNumber) {
            let correct = 0, total = checklistItems.length;
            checklistItems.forEach(item => {
                if (selections[tabNumber] && selections[tabNumber][item] === correctAnswers[item]) correct++;
            });
            const score = correct;
            const classificacao = getClassificacao(score);

            // Armazenar os dados do dia
            const data = {
                date: document.getElementById(`data${tabNumber}`).value,
                time: document.getElementById(`horario${tabNumber}`).value,
                paciente: document.getElementById(`paciente${tabNumber}`).value,
                leito: document.getElementById(`leito${tabNumber}`).value,
                observacoes: document.getElementById(`observacoes${tabNumber}`).value,
                score: score,
                classificacao: classificacao.text,
                respostas: selections[tabNumber]
            };
            storage[`leito${tabNumber}`].push(data);

            // Exibir resultado
            document.getElementById(`resultado${tabNumber}`).textContent = `Feito e Calculado! A equipe acertou ${score} de ${total} itens.`;
            document.getElementById(`classificacao${tabNumber}`).textContent = `Classificação: ${classificacao.text}`;
            document.getElementById(`classificacao${tabNumber}`).className = `classificacao ${classificacao.class}`;
        }

        function getClassificacao(score) {
            if (score >= 7) {
                return { text: "Ótima qualidade da assistência ✅", class: "otima" };
            } else if (score >= 5) {
                return { text: "Qualidade aceitável, mas com melhorias necessárias ⚠️", class: "aceitavel" };
            } else if (score >= 3) {
                return { text: "Risco moderado de falha na prevenção ❗", class: "risco-moderado" };
            } else {
                return { text: "Alto risco de falha na prevenção da PAV ❌", class: "alto-risco" };
            }
        }

        function exportToDoc(tabNumber) {
            const leitoData = storage[`leito${tabNumber}`];
            let content = "Relatório Diário - Checklist de Cuidados UTI\n\n";
            content += `Paciente: ${leitoData[0].paciente}\n`;
            content += `Leito: ${leitoData[0].leito}\n\n`;

            // Ordenar os dados por data
            leitoData.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Detalhes por dia
            content += "Detalhes por Dia:\n";
            leitoData.forEach((day, index) => {
                content += `Dia ${index + 1} (${day.date} - ${day.time}):\n`;
                content += `- Pontuação: ${day.score} de ${checklistItems.length}\n`;
                content += `- Classificação: ${day.classificacao}\n`;
                content += `- Observações: ${day.observacoes}\n\n`;
            });

            // Criar e baixar o arquivo DOC
            const blob = new Blob([content], { type: "application/msword" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `relatorio_diario_leito${tabNumber}.doc`;
            link.click();
        }

        function exportMonthlyReport(tabNumber) {
            const leitoData = storage[`leito${tabNumber}`];
            let content = "Relatório Mensal PAV - Checklist de Cuidados UTI\n\n";
            content += `Paciente: ${leitoData[0].paciente}\n`;
            content += `Leito: ${leitoData[0].leito}\n\n`;

            // Ordenar os dados por data
            leitoData.sort((a, b) => new Date(a.date) - new Date(b.date));

            // Detalhes por dia
            content += "Detalhes por Dia:\n";
            leitoData.forEach((day, index) => {
                const teveFebre = day.respostas["Teve febre de origem pulmonar nas últimas 24 horas?"] === "Sim";
                content += `Dia ${index + 1} (${day.date} - ${day.time}):\n`;
                content += `- Pontuação: ${day.score} de ${checklistItems.length}\n`;
                content += `- Classificação: ${day.classificacao}\n`;
                content += `- Teve febre de origem pulmonar: ${teveFebre ? "Sim" : "Não"}\n`;
                content += `- Observações: ${day.observacoes}\n\n`;
            });

            // Criar e baixar o arquivo DOC
            const blob = new Blob([content], { type: "application/msword" });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `relatorio_mensal_pav_leito${tabNumber}.doc`;
            link.click();
        }

        // Inicializa as checklists para cada aba
        for (let i = 1; i <= 10; i++) {
            initializeChecklist(i);
        }
    </script>
</body>
</html>